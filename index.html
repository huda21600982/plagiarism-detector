<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Plagiarism Detector</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
    theme: {
        extend: {
            colors: {
                'primary-blue': '#2563EB',
                'accent-purple': '#C084FC',
                'light-bg': '#F9FAFB',
            },
            fontFamily: {
                sans: ['Inter', 'sans-serif'],
            },
        }
    }
}
</script>
</head>
<body class="bg-light-bg dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen">

<header class="p-4 sm:p-6 bg-white dark:bg-gray-800 shadow-lg flex justify-between items-center border-b dark:border-gray-700">
    <h1 class="text-xl sm:text-2xl font-bold text-primary-blue dark:text-accent-purple">AI Plagiarism Detector</h1>
    <div class="flex items-center space-x-2">
        <span class="text-sm font-medium text-gray-600 dark:text-gray-400 hidden sm:inline">Dark Mode</span>
        <button id="darkToggle" class="w-12 h-6 bg-gray-300 dark:bg-gray-700 rounded-full flex items-center p-0.5">
            <div id="toggleCircle" class="w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 dark:translate-x-6"></div>
        </button>
    </div>
</header>

<main class="max-w-4xl mx-auto mt-8 sm:mt-12 p-6 sm:p-10 bg-white dark:bg-gray-800 rounded-xl shadow-2xl shadow-gray-200 dark:shadow-gray-900/50">
    <h2 class="text-2xl font-semibold mb-8 text-center text-primary-blue dark:text-accent-purple">Start Your Plagiarism Scan</h2>

    <!-- Language selector -->
    <div class="mb-4 flex justify-center">
        <select id="languageSelect" class="p-2 rounded border border-gray-300 dark:border-gray-700 dark:bg-gray-900">
            <option value="auto">Detect Language</option>
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="hi">Hindi</option>
            <option value="zh-cn">Chinese (Simplified)</option>
            <option value="ar">Arabic</option>
            <option value="ru">Russian</option>
        </select>
    </div>

    <textarea id="inputText" maxlength="10000" rows="12" class="w-full p-4 text-base rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-900 focus:ring-2 focus:ring-primary-blue/50 focus:border-primary-blue/50 dark:focus:ring-accent-purple dark:focus:border-accent-purple transition" placeholder="Paste your text here... (Supports up to 10,000 characters)"></textarea>

    <div class="mt-6 flex flex-wrap gap-4 justify-center">
        <button id="checkTextBtn" onclick="checkText()" class="px-8 py-3 bg-primary-blue hover:bg-primary-blue/90 text-white rounded-xl font-semibold shadow-lg shadow-primary-blue/30 transition transform hover:-translate-y-0.5">
            Check Text
        </button>
        <label class="px-8 py-3 bg-accent-purple hover:bg-accent-purple/90 text-white rounded-xl font-semibold shadow-lg shadow-accent-purple/30 cursor-pointer transition transform hover:-translate-y-0.5">
            <input id="fileInput" type="file" accept=".pdf,.docx,.txt" class="hidden" onchange="checkFile()" />
            Upload Document
        </label>
    </div>

    <div id="spinner" class="mt-8 flex justify-center hidden">
        <div class="w-10 h-10 border-4 border-primary-blue dark:border-accent-purple border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div class="mt-8 p-6 rounded-xl bg-gray-50 dark:bg-gray-700 border-2 border-dashed border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 shadow-inner text-base overflow-x-auto">
        <p class="font-medium text-gray-500 dark:text-gray-400 mb-1">SCAN RESULTS:</p>
        <div id="result">Result will appear here...</div>
    </div>
</main>

<script>
const toggleBtn = document.getElementById('darkToggle');
const toggleCircle = document.getElementById('toggleCircle');
const htmlEl = document.documentElement;

if (localStorage.getItem('theme') === 'dark') {
    htmlEl.classList.add('dark');
    toggleCircle.classList.add('translate-x-6');
}

toggleBtn.addEventListener('click', () => {
    htmlEl.classList.toggle('dark');
    if (htmlEl.classList.contains('dark')) {
        localStorage.setItem('theme', 'dark');
        toggleCircle.classList.add('translate-x-6');
    } else {
        localStorage.setItem('theme', 'light');
        toggleCircle.classList.remove('translate-x-6');
    }
});

const backendUrl = "http://127.0.0.1:5000";

async function checkText() {
    const text = document.getElementById("inputText").value.trim();
    const language = document.getElementById("languageSelect").value;
    if (!text) return alert("Enter some text.");
    toggleLoading(true);
    const resultBox = document.getElementById("result");
    resultBox.innerHTML = '<p class="italic text-gray-500 dark:text-gray-400">Scanning...</p>';

    try {
        const response = await fetch(`${backendUrl}/check-text`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ text, language })
        });
        const data = await response.json();
        toggleLoading(false);
        resultBox.innerHTML = data.error ? `<p class="text-red-500">${data.error}</p>` : formatResults(data);
    } catch(err) {
        console.error(err);
        toggleLoading(false);
        resultBox.innerHTML = `<p class="text-red-500">❌ Could not connect to backend.</p>`;
    }
}

async function checkFile() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return;
    const language = document.getElementById("languageSelect").value;
    toggleLoading(true);
    const resultBox = document.getElementById("result");
    resultBox.innerHTML = '<p class="italic text-gray-500 dark:text-gray-400">Uploading and scanning file...</p>';

    const formData = new FormData();
    formData.append("file", file);
    formData.append("language", language);

    try {
        const response = await fetch(`${backendUrl}/check-file`, { method: "POST", body: formData });
        const data = await response.json();
        toggleLoading(false);
        resultBox.innerHTML = data.error ? `<p class="text-red-500">${data.error}</p>` : formatResults(data);
    } catch(err) {
        console.error(err);
        toggleLoading(false);
        resultBox.innerHTML = `<p class="text-red-500">❌ Could not connect to backend.</p>`;
    }
}

function toggleLoading(isLoading) {
    document.getElementById("spinner").classList.toggle("hidden", !isLoading);
    document.getElementById("checkTextBtn").disabled = isLoading;
    const fileLabel = document.getElementById("fileInput").parentNode;
    fileLabel.classList.toggle("pointer-events-none", isLoading);
    fileLabel.classList.toggle("opacity-50", isLoading);
}

function escapeHtml(unsafe) {
    return unsafe.replace(/[&<>"']/g, (m)=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]));
}

function formatResults(data){
    let scoreColor = 'text-green-500';
    if(data.overall_score>30) scoreColor='text-yellow-500';
    if(data.overall_score>60) scoreColor='text-red-500';
    let html = `<p class="font-bold text-lg mb-3">Overall Score: <span class="${scoreColor}">${data.overall_score}%</span> → ${data.message}</p>`;
    data.details.forEach((d,i)=>{
        let chunkText = escapeHtml(d.chunk_text);
        if(d.matches) d.matches.forEach(m=>{
            const snippet = escapeHtml(m.matched_text.slice(0,150));
            const re = new RegExp(snippet.replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1'),'gms');
            chunkText = chunkText.replace(re, `<span class="bg-yellow-300/80 dark:bg-yellow-600/80 rounded-sm">${snippet}</span>`);
        });
        html += `<div class="mb-3 p-3 rounded-lg bg-gray-100 dark:bg-gray-600 border border-gray-200 dark:border-gray-700">
            <p class="font-semibold mb-2">Chunk ${i+1}: ${(d.best_similarity*100).toFixed(2)}% Similarity</p>
            <p class="text-sm whitespace-pre-wrap">${chunkText}</p>
            ${d.matches && d.matches.length ? `<p class="mt-2 text-xs font-medium text-gray-700 dark:text-gray-300 border-t pt-1">Top Matches:</p>
            <ul class="text-xs list-disc ml-5 mt-1">${d.matches.slice(0,3).map(m=>`<li>${escapeHtml(m.source)} (${(m.similarity*100).toFixed(2)}%)<br><em>${escapeHtml(m.matched_text.slice(0,100))}...</em></li>`).join('')}</ul>`: `<p class="mt-2 text-xs text-gray-500 dark:text-gray-400">No significant matches found.</p>`}
        </div>`;
    });
    return html;
}
</script>
</body>
</html>























